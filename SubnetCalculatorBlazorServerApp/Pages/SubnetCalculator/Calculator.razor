@page "/subnetcalculator/calculator"
@inject SubnetCalculatorEngine.Services.SubnetCalculatorEngine SubnetCalculator
@inject SubnetCalculatorEngine.Models.SubnetCalculatorInput SubnetCalculatorInput
@inject SubnetCalculatorEngine.Models.SubnetCalculatorResult SubnetCalculatorResult


<style>
    table, td, th {
        border: 1px solid black;
    }

    table {
        border-collapse: collapse;
        margin-bottom: 25px;
    }

    #tblNetworksOverview {
        width: 265px;
    }

    #tblSubnetCalculationResult {
        width: 560px;
    }

    #tblSubnetCalculationWithNetowrkMaskResult {
        width: 655px;

    }

    #tblNetworks {
        width: 780px;
        text-align: center;
    }
</style>

<h3>IP Subnet Calculator</h3>

<div>
    <h2>IPv4 Subnet Calculator</h2>

    <div style="padding-bottom: 25px;">
        <EditForm Model="SubnetCalculatorInput" OnValidSubmit="@CalculateSubnet">
            <div class="form-group">
                <label class="control-label col-md-2">IP Address</label>
                <div class="col-md-3">
                    <InputText class="form-control" @bind-Value="SubnetCalculatorInput.IPAddress" />
                    <ValidationMessage For="(() => SubnetCalculatorInput.IPAddress)" />
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-md-2">Number of Networks</label>
                <div class="col-md-3">
                    <InputNumber class="form-control" @bind-Value="SubnetCalculatorInput.NumberOfNetworks" />
                    <ValidationMessage For="(() => SubnetCalculatorInput.NumberOfNetworks)" />
                </div>
            </div>

            <button type="submit">Calculate</button>
        </EditForm>
    </div>

    @if (isSubnetCalculationError)
    {
        <div style="color:red; padding-bottom: 20px">

            <ul>
                <li>@SubnetCalculatorResult.ErrorMessage</li>
            </ul>
        </div>
    }

    @if (isSubnetCalculated)
    {
        <table id="tblNetworksOverview">
            <tr>
                <td>Number of extra bits required:</td>
                <td>@SubnetCalculatorResult.NumberOfExtraBitsRequired</td>
            </tr>
            <tr>
                <td>Number of networks provided:</td>
                <td>@SubnetCalculatorResult.NumberOfNetworksProvided</td>
            </tr>
        </table>

        <table id="tblSubnetCalculationResult">
            <tr>
                <td>IP Address:</td>
                <td>@SubnetCalculatorResult.IPAddress</td>
            </tr>
            <tr>
                <td>IP Address in Binary:</td>
                <td>@SubnetCalculatorResult.IPAddressInBinary</td>
            </tr>
            <tr>
                <td>Subnet Mask IP Address:</td>
                <td>@SubnetCalculatorResult.SubnetMaskIPAddress</td>
            </tr>
            <tr>
                <td>Subnet Mask IP Address in Binary:</td>
                <td>@SubnetCalculatorResult.SubnetMaskIPAddress</td>
            </tr>
            <tr>
                <td>Network Address:</td>
                <td>@SubnetCalculatorResult.NetworkIPAddress</td>
            </tr>
            <tr>
                <td>Network Address in Binary:</td>
                <td>@SubnetCalculatorResult.NetworkAddressInBinary</td>
            </tr>
            <tr>
                <td>Broadcast Address:</td>
                <td>@SubnetCalculatorResult.BroadcastIPAddress</td>
            </tr>
            <tr>
                <td>Broadcast Address in Binary:</td>
                <td>@SubnetCalculatorResult.BroadcastAddressInBinary</td>
            </tr>
            <tr>
                <td>Usable Host IP Range:</td>
                <td>@SubnetCalculatorResult.FirstUsableIPAddress - @SubnetCalculatorResult.LastUsableIPAddress</td>
            </tr>
            <tr>
                <td>Total Number of Hosts:</td>
                <td>@SubnetCalculatorResult.TotalNumberOfHosts</td>
            </tr>
            <tr>
                <td>Number of Usable Hosts:</td>
                <td>@SubnetCalculatorResult.NumberOfUsableHosts</td>
            </tr>
            <tr>
                <td>Reverse Arpa Host Name:</td>
                <td>@SubnetCalculatorResult.ReverseArpaHostName</td>
            </tr>
            <tr>
                <td>Reverse Arpa IP Address:</td>
                <td>@SubnetCalculatorResult.ReverseArpaIPAddresss</td>
            </tr>
        </table>

        <table id="tblSubnetCalculationWithNetowrkMaskResult">
            <tr>
                <td>Subnet mask with networks IP Address:</td>
                <td>@SubnetCalculatorResult.NetworkSubnetMaskIPAddress</td>
            </tr>
            <tr>
                <td>Subnet mask with network address in binary:</td>
                <td>@SubnetCalculatorResult.NetworkSubnetMaskInBinary</td>
            </tr>
            <tr>
                <td>Network with network mask IP Address:</td>
                <td>@SubnetCalculatorResult.NetworkWithNetworkMaskIPAddress</td>
            </tr>
            <tr>
                <td>Network address with network mask in binary:</td>
                <td>@SubnetCalculatorResult.NetworkWithNetworkMaskAddressInBinary</td>
            </tr>
            <tr>
                <td>Broadcast with network mask IP Address:</td>
                <td>@SubnetCalculatorResult.BroadcastWithNetworkMaskIPAddress</td>
            </tr>
            <tr>
                <td>Broadcast address with network mask in binary:</td>
                <td>@SubnetCalculatorResult.BroadcastWithNetworkMaskAddressInBinary</td>
            </tr>
            <tr>
                <td>Usable Host IP Range with network mask:</td>
                <td>@SubnetCalculatorResult.FirstUsableWithNetworkMaskIPAddress - @SubnetCalculatorResult.LastUsableWithNetworkMaskIPAddress</td>
            </tr>
        </table>

        @if (SubnetCalculatorResult.Networks.Count > 0)
        {
            <table id="tblNetworks">
                <tr>
                    <th>Network Number</th>
                    <th>Network IP Address</th>
                    <th>Broadcast IP Address</th>
                    <th>Usable Host IP Range</th>
                </tr>
                @foreach (var network in SubnetCalculatorResult.Networks)
                {
                    <tr>
                        <td>@network.NetworkNumber</td>
                        <td>@network.NetworkAddress</td>
                        <td>@network.BroadcastAddress</td>
                        <td>@network.FirstUsableIPAddress - @network.LastUsableIPAddress</td>
                    </tr>
                }
            </table>
        }
    }
</div>

@code {
    private bool isSubnetCalculated => SubnetCalculatorResult != null
                                        && string.IsNullOrEmpty(SubnetCalculatorResult.ErrorMessage)
                                        && !string.IsNullOrEmpty(SubnetCalculatorResult.IPAddress);

    private bool isSubnetCalculationError => SubnetCalculatorResult != null
                                        && !string.IsNullOrEmpty(SubnetCalculatorResult.ErrorMessage);

    protected override void OnInitialized()
    {
        SubnetCalculator = new SubnetCalculatorEngine.Services.SubnetCalculatorEngine();
    }

    private void CalculateSubnet()
    {
        SubnetCalculatorResult = SubnetCalculator.CalculateSubnet(SubnetCalculatorInput);
    }
}
